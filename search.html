<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://cdn.jsdelivr.net/npm/@searchkit/instantsearch-client@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/searchkit@latest"></script>
    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/instantsearch.css@7/themes/algolia-min.css"
    />
</head>
<body>
<div class="ais-InstantSearch">

    <div class="left-panel">
        <h2>Categories</h2>
        <div id="categories-list"></div>
    </div>
    <div class="left-panel">
        <h2>Publisher</h2>
        <div id="publisher-list"></div>
    </div>
    <div class="left-panel">
        <h2>State</h2>
        <div id="state-list"></div>
    </div>
    <div class="right-panel">
        <div id="searchbox" class="ais-SearchBox"></div>
        <div id="hits"></div>
        <div id="pagination"></div>
    </div>
</div>

<script type="text/javascript">
    /* global instantsearch algoliasearch */

    const sk = new Searchkit({
        connection: {
            host: "http://localhost:9200",
            // cloud_id: "my-cloud-id" // if using Elastic Cloud
            // if you are authenticating with username/password
            // https://www.searchkit.co/docs/guides/setup-elasticsearch#connecting-with-usernamepassword
            //auth: {
            //  username: "elastic",
            //  password: "changeme"
            //},
            // if you are authenticating with api key
            // https://www.searchkit.co/docs/guides/setup-elasticsearch#connecting-with-api-key
            // apiKey: "######"
        },
        search_settings: {
            highlight_attributes: ["metadata.publisher", "metadata.titles.value"],
            snippet_attributes: ["metadata.titles.0.value"],
            search_attributes: [{field: "metadata.publisher", weight: 3}, "metadata.titles.value", "metadata.resourceType.typeGeneral"],
            result_attributes: [ "metadata.publisher", "metadata.publicationYear", "metadata.titles.value", "metadata.resourceType.typeGeneral"],
            facet_attributes: [{
                field: "metadata.resourceType.typeGeneral",
                type: "string",
                attribute: "typeGeneral",
            }, {
                field: "metadata.publisher.keyword",
                type: "string",
                attribute: "publisher"
            }, {
                field: "metadata.state",
                type: "string",
                attribute: "state",
            }]/*,
            filter_attributes: [
                { field: 'lastUpdate', attribute: 'metadata.lastUpdate', type: 'date' }
            ],*/
        }
    })

    const search = instantsearch({
        indexName: "baserepo",
        searchClient: SearchkitInstantsearchClient(sk)
    });

    search.addWidgets([
        instantsearch.widgets.searchBox({
            container: "#searchbox"
        }),
        instantsearch.widgets.refinementList({
            container: "#categories-list",
            attribute: "typeGeneral"
        }),
        instantsearch.widgets.refinementList({
            container: "#publisher-list",
            attribute: "publisher"
        })/*,
        instantsearch.widgets.numericMenu({
            container: "#lastUpdate-list",
            attribute: "lastUpdate",
            items: [
                { label: 'All' },
                { label: 'Later', end: new Date("2023-12-31T00:00:00Z").getTime() },
                { label: '2023', start: new Date("2023-01-01T00:00:00Z").getTime(), end: new Date("2023-12-31T00:00:00Z").getTime() }
            ],
        })*/,
        instantsearch.widgets.refinementList({
            container: "#state-list",
            attribute: "state"
        }),
        instantsearch.widgets.hits({
            container: "#hits",
            templates: {
                item(hit, { html, components }) {
                    let high = hit._highlightResult["metadata.titles.value"].value;
                    return html`
                <h2>
                  ${hit.__hitIndex}:
                  ${high}
                </h2>
                <p>${components.Snippet({ attribute: 'metadata.resourceType.typeGeneral', hit })}</p>
              `;
                }
            }
        }),
        instantsearch.widgets.pagination({
            container: "#pagination"
        })
    ]);

    search.start();
</script>

</body>
</html>
